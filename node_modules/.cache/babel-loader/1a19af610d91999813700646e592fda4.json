{"ast":null,"code":"\"use strict\";\n/*\n\n MIT License\n\n Copyright (c) 2021 Looker Data Sciences, Inc.\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in all\n copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n SOFTWARE.\n\n */\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ChattyHost = exports.ChattyHostStates = void 0;\n\nvar debugLib = require(\"debug\");\n\nvar client_messages_1 = require(\"./client_messages\");\n\nvar host_messages_1 = require(\"./host_messages\");\n\nrequire(\"es6-promise/auto\"); // Polyfill only browsers without Promises\n\n/**\n * @private\n * Host connection status\n */\n\n\nvar ChattyHostStates;\n\n(function (ChattyHostStates) {\n  ChattyHostStates[ChattyHostStates[\"Connecting\"] = 0] = \"Connecting\";\n  ChattyHostStates[ChattyHostStates[\"SynAck\"] = 1] = \"SynAck\";\n  ChattyHostStates[ChattyHostStates[\"Connected\"] = 2] = \"Connected\";\n})(ChattyHostStates = exports.ChattyHostStates || (exports.ChattyHostStates = {}));\n/**\n * The host object for an iframe. The user should not create this object directly, it\n * is returned by the [[ChattyHostBuilder.build]] method.\n */\n\n\nvar ChattyHost =\n/** @class */\nfunction () {\n  /**\n   * @param builder The client builder that is responsible for constructing this object.\n   * @hidden\n   */\n  function ChattyHost(builder) {\n    var _this = this;\n\n    this._hostWindow = window;\n    this._connection = null;\n    this._state = ChattyHostStates.Connecting;\n    this._sequence = 0;\n    this._receivers = {};\n    this.iframe = document.createElement('iframe');\n    builder.sandboxAttrs.forEach(function (attr) {\n      return _this.iframe.sandbox.add(attr);\n    });\n\n    if ('allow' in this.iframe) {\n      this.iframe.allow = builder.allowAttrs.join('; ');\n    } // tslint:disable-next-line:deprecation\n\n\n    this.iframe.frameBorder = builder.getFrameBorder();\n\n    if (builder.url) {\n      this.iframe.src = builder.url;\n    } else if (builder.source) {\n      this.iframe.srcdoc = builder.source;\n    } else {\n      console.warn('url or source required to initialize Chatty host correctly');\n    }\n\n    this._appendTo = builder.el;\n    this._handlers = builder.handlers;\n    this._abortControllers = {};\n    this._port = null;\n    this._targetOrigin = builder.targetOrigin;\n    this._defaultTimeout = builder.defaultTimeout;\n  }\n\n  Object.defineProperty(ChattyHost.prototype, \"connection\", {\n    /**\n     * @returns a Promise to an object that resolves when the client initiates the connection.\n     */\n    get: function () {\n      return this._connection;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(ChattyHost.prototype, \"isConnected\", {\n    /**\n     * @returns a flag indicating whether the client successfully connected to the host.\n     */\n    get: function () {\n      return this._state === ChattyHostStates.Connected;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\n   * Connects to the client iframe. Waits for the client iframe to load and initiate a\n   * connection using the chatty client.\n   *\n   * @returns a Promise to an object that resolves when the client has initiated the connection. The\n   * object implements the [[ChattyHostConnection]] that can be used to talk to the host.\n   */\n\n  ChattyHost.prototype.connect = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var createConnection;\n\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        if (this._connection) return [2\n        /*return*/\n        , this._connection];\n\n        createConnection = function () {\n          return __awaiter(_this, void 0, void 0, function () {\n            var _this = this;\n\n            return __generator(this, function (_a) {\n              return [2\n              /*return*/\n              , new Promise(function (resolve, reject) {\n                var eventListener = function (evt) {\n                  ChattyHost._debug('port received', evt.data.action, evt.data.data);\n\n                  switch (evt.data.action) {\n                    case client_messages_1.ChattyClientMessages.Ack:\n                      _this._state = ChattyHostStates.Connected;\n                      resolve({\n                        send: function (eventName) {\n                          var payload = [];\n\n                          for (var _i = 1; _i < arguments.length; _i++) {\n                            payload[_i - 1] = arguments[_i];\n                          }\n\n                          _this.sendMsg(host_messages_1.ChattyHostMessages.Message, {\n                            eventName: eventName,\n                            payload: payload\n                          });\n                        },\n                        sendAndReceive: function (eventName) {\n                          var _payload = [];\n\n                          for (var _i = 1; _i < arguments.length; _i++) {\n                            _payload[_i - 1] = arguments[_i];\n                          }\n\n                          return __awaiter(_this, void 0, void 0, function () {\n                            var signal, propagateSignal, payload, options, sequence;\n\n                            var _this = this;\n\n                            var _a, _b;\n\n                            return __generator(this, function (_c) {\n                              if (_payload.length > 0 && ((_a = _payload[_payload.length - 1]) === null || _a === void 0 ? void 0 : _a.signal) && ((_b = _payload[_payload.length - 1]) === null || _b === void 0 ? void 0 : _b.signal) instanceof AbortSignal) {\n                                options = _payload[_payload.length - 1];\n                                signal = options.signal;\n                                propagateSignal = options.propagateSignal;\n                                payload = _payload.slice(0, _payload.length - 1);\n                              } else {\n                                payload = _payload;\n                              }\n\n                              sequence = ++this._sequence;\n                              this.sendMsg(host_messages_1.ChattyHostMessages.MessageWithResponse, {\n                                eventName: eventName,\n                                payload: payload\n                              }, sequence, propagateSignal);\n                              return [2\n                              /*return*/\n                              , new Promise(function (resolve, reject) {\n                                var timeoutId;\n\n                                if (signal) {\n                                  signal.addEventListener('abort', function (event) {\n                                    if (propagateSignal) {\n                                      var errorMessage_1 = event.target.reason;\n\n                                      if (typeof errorMessage_1 !== 'string') {\n                                        errorMessage_1 = 'Abort';\n                                      }\n\n                                      _this.sendMsg(host_messages_1.ChattyHostMessages.AbortMessage, {\n                                        eventName: eventName,\n                                        payload: {\n                                          reason: errorMessage_1\n                                        }\n                                      }, sequence);\n                                    }\n\n                                    delete _this._receivers[sequence];\n                                    var errorMessage = event.target.reason;\n\n                                    if (typeof errorMessage !== 'string') {\n                                      errorMessage = 'Abort';\n                                    }\n\n                                    reject(new Error(errorMessage));\n                                  });\n                                } else {\n                                  if (_this._defaultTimeout > -1) {\n                                    timeoutId = setTimeout(function () {\n                                      delete _this._receivers[sequence];\n                                      reject(new Error('Timeout'));\n                                    }, _this._defaultTimeout);\n                                  }\n                                }\n\n                                _this._receivers[sequence] = {\n                                  reject: reject,\n                                  resolve: resolve,\n                                  timeoutId: timeoutId\n                                };\n                              })];\n                            });\n                          });\n                        }\n                      });\n                      break;\n\n                    case client_messages_1.ChattyClientMessages.Message:\n                      if (_this._handlers[evt.data.data.eventName]) {\n                        _this._handlers[evt.data.data.eventName].forEach(function (fn) {\n                          return fn.apply(_this, evt.data.data.payload);\n                        });\n                      }\n\n                      break;\n\n                    case client_messages_1.ChattyClientMessages.MessageWithResponse:\n                      {\n                        var _a = evt.data.data,\n                            eventName_1 = _a.eventName,\n                            payload = _a.payload,\n                            sequence_1 = _a.sequence,\n                            signal = _a.signal;\n                        var results = [];\n                        var abortStoreName_1 = \"\".concat(eventName_1).concat(sequence_1);\n\n                        if (_this._handlers[eventName_1]) {\n                          var _payload_1;\n\n                          if (signal) {\n                            _this._abortControllers[abortStoreName_1] = new AbortController();\n\n                            if (Array.isArray(payload)) {\n                              _payload_1 = __spreadArray(__spreadArray([], payload, true), [_this._abortControllers[abortStoreName_1].signal], false);\n                            } else {\n                              _payload_1 = [payload, _this._abortControllers[abortStoreName_1].signal];\n                            }\n                          } else {\n                            _payload_1 = payload;\n                          }\n\n                          results = _this._handlers[eventName_1].map(function (fn) {\n                            return fn.apply(_this, _payload_1);\n                          });\n                        }\n\n                        Promise.all(results).then(function (resolvedResults) {\n                          delete _this._abortControllers[abortStoreName_1];\n\n                          _this.sendMsg(host_messages_1.ChattyHostMessages.Response, {\n                            eventName: eventName_1,\n                            payload: resolvedResults\n                          }, sequence_1);\n                        }).catch(function (error) {\n                          delete _this._abortControllers[abortStoreName_1];\n\n                          _this.sendMsg(host_messages_1.ChattyHostMessages.ResponseError, {\n                            eventName: eventName_1,\n                            payload: error.toString()\n                          }, sequence_1);\n                        });\n                      }\n                      break;\n\n                    case client_messages_1.ChattyClientMessages.AbortMessage:\n                      {\n                        var _b = evt.data.data,\n                            eventName = _b.eventName,\n                            payload = _b.payload,\n                            sequence = _b.sequence;\n                        var abortStoreName = \"\".concat(eventName).concat(sequence);\n\n                        if (_this._abortControllers[abortStoreName]) {\n                          _this._abortControllers[abortStoreName].abort(payload === null || payload === void 0 ? void 0 : payload.reason);\n\n                          delete _this._abortControllers[abortStoreName];\n                        }\n                      }\n                      break;\n\n                    case client_messages_1.ChattyClientMessages.Response:\n                      {\n                        var receiver = _this._receivers[evt.data.data.sequence];\n\n                        if (receiver) {\n                          delete _this._receivers[evt.data.data.sequence];\n\n                          if (receiver.timeoutId) {\n                            clearTimeout(receiver.timeoutId);\n                          }\n\n                          receiver.resolve(evt.data.data.payload);\n                        }\n                      }\n                      break;\n\n                    case client_messages_1.ChattyClientMessages.ResponseError:\n                      {\n                        var receiver = _this._receivers[evt.data.data.sequence];\n\n                        if (receiver) {\n                          delete _this._receivers[evt.data.data.sequence];\n\n                          if (receiver.timeoutId) {\n                            clearTimeout(receiver.timeoutId);\n                          }\n\n                          receiver.reject(typeof evt.data.data.payload === 'string' ? new Error(evt.data.data.payload) : evt.data.data.payload);\n                        }\n                      }\n                      break;\n                  }\n                };\n\n                var windowListener = function (evt) {\n                  if (!_this.isValidMsg(evt)) {\n                    // don't reject here, since that breaks the promise resolution chain\n                    ChattyHost._debug('window received invalid', evt);\n\n                    return;\n                  }\n\n                  ChattyHost._debug('window received', evt.data.action, evt.data.data);\n\n                  switch (evt.data.action) {\n                    case client_messages_1.ChattyClientMessages.Syn:\n                      if (_this._port) {\n                        // If targetOrigin is set and we receive another Syn, the frame has potentially\n                        // navigated to another valid webpage and we should re-connect\n                        if (_this._targetOrigin && _this._targetOrigin === '*' || _this._targetOrigin === evt.origin) {\n                          ChattyHost._debug('reconnecting to', evt.origin);\n\n                          _this._port.close();\n                        } else {\n                          ChattyHost._debug('rejected new connection from', evt.origin);\n\n                          return;\n                        }\n                      }\n\n                      _this._port = evt.ports[0];\n                      _this._port.onmessage = eventListener;\n\n                      _this.sendMsg(host_messages_1.ChattyHostMessages.SynAck);\n\n                      _this._state = ChattyHostStates.SynAck;\n                      break;\n                  }\n                };\n\n                _this._hostWindow.addEventListener('message', windowListener);\n              })];\n            });\n          });\n        };\n\n        this._appendTo.appendChild(this.iframe);\n\n        return [2\n        /*return*/\n        , this._connection = createConnection()];\n      });\n    });\n  };\n\n  ChattyHost.prototype.sendMsg = function (action, data, sequence, propagateSignal) {\n    if (data === void 0) {\n      data = {};\n    }\n\n    var sequenceData = sequence ? {\n      sequence: sequence\n    } : {};\n    var signalData = propagateSignal === true ? {\n      signal: propagateSignal\n    } : {};\n\n    var dataWithSequence = __assign(__assign(__assign({}, data), sequenceData), signalData);\n\n    ChattyHost._debug('sending', action, dataWithSequence);\n\n    this._port.postMessage({\n      action: action,\n      data: dataWithSequence\n    });\n  }; // TODO: natenate\n  // Frustratingly, enabling `allow-scripts` on a sandboxed iframe sets its origin to `'null'`\n  // (that is, a string literal with a value of null). This means that in order to `postMessage`\n  // to the client we must use `'*'` as the origin parameter.  To ensure messages received from\n  // the client are who they claim to be, we check the origin is `'null'` and the contentWindow\n  // is the one we have access to from the parent frame.  This method is described here:\n  // https://www.html5rocks.com/en/tutorials/security/sandboxed-iframes/#safely-sandboxing-eval\n  // If sandboxing is not enabled targetOrigin can be set and validated\n\n\n  ChattyHost.prototype.isValidMsg = function (evt) {\n    if (evt.source !== this.iframe.contentWindow) return false;\n    if (this._targetOrigin && !(this._targetOrigin === '*' || this._targetOrigin === evt.origin)) return false;\n    return true;\n  };\n\n  ChattyHost._debug = debugLib('looker:chatty:host');\n  return ChattyHost;\n}();\n\nexports.ChattyHost = ChattyHost;","map":{"version":3,"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","__generator","body","_","label","sent","trys","ops","f","y","g","verb","Symbol","iterator","v","op","TypeError","pop","push","__spreadArray","to","from","pack","l","ar","Array","slice","concat","defineProperty","exports","ChattyHost","ChattyHostStates","debugLib","require","client_messages_1","host_messages_1","builder","_this","_hostWindow","window","_connection","_state","Connecting","_sequence","_receivers","iframe","document","createElement","sandboxAttrs","forEach","attr","sandbox","add","allow","allowAttrs","join","frameBorder","getFrameBorder","url","src","source","srcdoc","console","warn","_appendTo","el","_handlers","handlers","_abortControllers","_port","_targetOrigin","targetOrigin","_defaultTimeout","defaultTimeout","get","enumerable","configurable","Connected","connect","createConnection","_a","eventListener","evt","_debug","data","action","ChattyClientMessages","Ack","send","eventName","payload","_i","sendMsg","ChattyHostMessages","Message","sendAndReceive","_payload","signal","propagateSignal","options","sequence","_b","_c","AbortSignal","MessageWithResponse","timeoutId","addEventListener","event","errorMessage_1","target","reason","AbortMessage","errorMessage","Error","setTimeout","fn","eventName_1","sequence_1","results","abortStoreName_1","_payload_1","AbortController","isArray","map","all","resolvedResults","Response","catch","error","ResponseError","toString","abortStoreName","abort","receiver","clearTimeout","windowListener","isValidMsg","Syn","origin","close","ports","onmessage","SynAck","appendChild","sequenceData","signalData","dataWithSequence","postMessage","contentWindow"],"sources":["/Users/elizabethrodricks/Downloads/express-react-starter-master/node_modules/@looker/chatty/lib/host.js"],"sourcesContent":["\"use strict\";\n/*\n\n MIT License\n\n Copyright (c) 2021 Looker Data Sciences, Inc.\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in all\n copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n SOFTWARE.\n\n */\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ChattyHost = exports.ChattyHostStates = void 0;\nvar debugLib = require(\"debug\");\nvar client_messages_1 = require(\"./client_messages\");\nvar host_messages_1 = require(\"./host_messages\");\nrequire(\"es6-promise/auto\"); // Polyfill only browsers without Promises\n/**\n * @private\n * Host connection status\n */\nvar ChattyHostStates;\n(function (ChattyHostStates) {\n    ChattyHostStates[ChattyHostStates[\"Connecting\"] = 0] = \"Connecting\";\n    ChattyHostStates[ChattyHostStates[\"SynAck\"] = 1] = \"SynAck\";\n    ChattyHostStates[ChattyHostStates[\"Connected\"] = 2] = \"Connected\";\n})(ChattyHostStates = exports.ChattyHostStates || (exports.ChattyHostStates = {}));\n/**\n * The host object for an iframe. The user should not create this object directly, it\n * is returned by the [[ChattyHostBuilder.build]] method.\n */\nvar ChattyHost = /** @class */ (function () {\n    /**\n     * @param builder The client builder that is responsible for constructing this object.\n     * @hidden\n     */\n    function ChattyHost(builder) {\n        var _this = this;\n        this._hostWindow = window;\n        this._connection = null;\n        this._state = ChattyHostStates.Connecting;\n        this._sequence = 0;\n        this._receivers = {};\n        this.iframe = document.createElement('iframe');\n        builder.sandboxAttrs.forEach(function (attr) { return _this.iframe.sandbox.add(attr); });\n        if ('allow' in this.iframe) {\n            this.iframe.allow = builder.allowAttrs.join('; ');\n        }\n        // tslint:disable-next-line:deprecation\n        this.iframe.frameBorder = builder.getFrameBorder();\n        if (builder.url) {\n            this.iframe.src = builder.url;\n        }\n        else if (builder.source) {\n            this.iframe.srcdoc = builder.source;\n        }\n        else {\n            console.warn('url or source required to initialize Chatty host correctly');\n        }\n        this._appendTo = builder.el;\n        this._handlers = builder.handlers;\n        this._abortControllers = {};\n        this._port = null;\n        this._targetOrigin = builder.targetOrigin;\n        this._defaultTimeout = builder.defaultTimeout;\n    }\n    Object.defineProperty(ChattyHost.prototype, \"connection\", {\n        /**\n         * @returns a Promise to an object that resolves when the client initiates the connection.\n         */\n        get: function () {\n            return this._connection;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ChattyHost.prototype, \"isConnected\", {\n        /**\n         * @returns a flag indicating whether the client successfully connected to the host.\n         */\n        get: function () {\n            return this._state === ChattyHostStates.Connected;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Connects to the client iframe. Waits for the client iframe to load and initiate a\n     * connection using the chatty client.\n     *\n     * @returns a Promise to an object that resolves when the client has initiated the connection. The\n     * object implements the [[ChattyHostConnection]] that can be used to talk to the host.\n     */\n    ChattyHost.prototype.connect = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var createConnection;\n            var _this = this;\n            return __generator(this, function (_a) {\n                if (this._connection)\n                    return [2 /*return*/, this._connection];\n                createConnection = function () { return __awaiter(_this, void 0, void 0, function () {\n                    var _this = this;\n                    return __generator(this, function (_a) {\n                        return [2 /*return*/, new Promise(function (resolve, reject) {\n                                var eventListener = function (evt) {\n                                    ChattyHost._debug('port received', evt.data.action, evt.data.data);\n                                    switch (evt.data.action) {\n                                        case client_messages_1.ChattyClientMessages.Ack:\n                                            _this._state = ChattyHostStates.Connected;\n                                            resolve({\n                                                send: function (eventName) {\n                                                    var payload = [];\n                                                    for (var _i = 1; _i < arguments.length; _i++) {\n                                                        payload[_i - 1] = arguments[_i];\n                                                    }\n                                                    _this.sendMsg(host_messages_1.ChattyHostMessages.Message, {\n                                                        eventName: eventName,\n                                                        payload: payload,\n                                                    });\n                                                },\n                                                sendAndReceive: function (eventName) {\n                                                    var _payload = [];\n                                                    for (var _i = 1; _i < arguments.length; _i++) {\n                                                        _payload[_i - 1] = arguments[_i];\n                                                    }\n                                                    return __awaiter(_this, void 0, void 0, function () {\n                                                        var signal, propagateSignal, payload, options, sequence;\n                                                        var _this = this;\n                                                        var _a, _b;\n                                                        return __generator(this, function (_c) {\n                                                            if (_payload.length > 0 &&\n                                                                ((_a = _payload[_payload.length - 1]) === null || _a === void 0 ? void 0 : _a.signal) &&\n                                                                ((_b = _payload[_payload.length - 1]) === null || _b === void 0 ? void 0 : _b.signal) instanceof AbortSignal) {\n                                                                options = _payload[_payload.length - 1];\n                                                                signal = options.signal;\n                                                                propagateSignal = options.propagateSignal;\n                                                                payload = _payload.slice(0, _payload.length - 1);\n                                                            }\n                                                            else {\n                                                                payload = _payload;\n                                                            }\n                                                            sequence = ++this._sequence;\n                                                            this.sendMsg(host_messages_1.ChattyHostMessages.MessageWithResponse, { eventName: eventName, payload: payload }, sequence, propagateSignal);\n                                                            return [2 /*return*/, new Promise(function (resolve, reject) {\n                                                                    var timeoutId;\n                                                                    if (signal) {\n                                                                        signal.addEventListener('abort', function (event) {\n                                                                            if (propagateSignal) {\n                                                                                var errorMessage_1 = event.target\n                                                                                    .reason;\n                                                                                if (typeof errorMessage_1 !== 'string') {\n                                                                                    errorMessage_1 = 'Abort';\n                                                                                }\n                                                                                _this.sendMsg(host_messages_1.ChattyHostMessages.AbortMessage, {\n                                                                                    eventName: eventName,\n                                                                                    payload: { reason: errorMessage_1 },\n                                                                                }, sequence);\n                                                                            }\n                                                                            delete _this._receivers[sequence];\n                                                                            var errorMessage = event.target.reason;\n                                                                            if (typeof errorMessage !== 'string') {\n                                                                                errorMessage = 'Abort';\n                                                                            }\n                                                                            reject(new Error(errorMessage));\n                                                                        });\n                                                                    }\n                                                                    else {\n                                                                        if (_this._defaultTimeout > -1) {\n                                                                            timeoutId = setTimeout(function () {\n                                                                                delete _this._receivers[sequence];\n                                                                                reject(new Error('Timeout'));\n                                                                            }, _this._defaultTimeout);\n                                                                        }\n                                                                    }\n                                                                    _this._receivers[sequence] = { reject: reject, resolve: resolve, timeoutId: timeoutId };\n                                                                })];\n                                                        });\n                                                    });\n                                                },\n                                            });\n                                            break;\n                                        case client_messages_1.ChattyClientMessages.Message:\n                                            if (_this._handlers[evt.data.data.eventName]) {\n                                                _this._handlers[evt.data.data.eventName].forEach(function (fn) {\n                                                    return fn.apply(_this, evt.data.data.payload);\n                                                });\n                                            }\n                                            break;\n                                        case client_messages_1.ChattyClientMessages.MessageWithResponse:\n                                            {\n                                                var _a = evt.data.data, eventName_1 = _a.eventName, payload = _a.payload, sequence_1 = _a.sequence, signal = _a.signal;\n                                                var results = [];\n                                                var abortStoreName_1 = \"\".concat(eventName_1).concat(sequence_1);\n                                                if (_this._handlers[eventName_1]) {\n                                                    var _payload_1;\n                                                    if (signal) {\n                                                        _this._abortControllers[abortStoreName_1] =\n                                                            new AbortController();\n                                                        if (Array.isArray(payload)) {\n                                                            _payload_1 = __spreadArray(__spreadArray([], payload, true), [\n                                                                _this._abortControllers[abortStoreName_1].signal,\n                                                            ], false);\n                                                        }\n                                                        else {\n                                                            _payload_1 = [\n                                                                payload,\n                                                                _this._abortControllers[abortStoreName_1].signal,\n                                                            ];\n                                                        }\n                                                    }\n                                                    else {\n                                                        _payload_1 = payload;\n                                                    }\n                                                    results = _this._handlers[eventName_1].map(function (fn) {\n                                                        return fn.apply(_this, _payload_1);\n                                                    });\n                                                }\n                                                Promise.all(results)\n                                                    .then(function (resolvedResults) {\n                                                    delete _this._abortControllers[abortStoreName_1];\n                                                    _this.sendMsg(host_messages_1.ChattyHostMessages.Response, { eventName: eventName_1, payload: resolvedResults }, sequence_1);\n                                                })\n                                                    .catch(function (error) {\n                                                    delete _this._abortControllers[abortStoreName_1];\n                                                    _this.sendMsg(host_messages_1.ChattyHostMessages.ResponseError, { eventName: eventName_1, payload: error.toString() }, sequence_1);\n                                                });\n                                            }\n                                            break;\n                                        case client_messages_1.ChattyClientMessages.AbortMessage:\n                                            {\n                                                var _b = evt.data.data, eventName = _b.eventName, payload = _b.payload, sequence = _b.sequence;\n                                                var abortStoreName = \"\".concat(eventName).concat(sequence);\n                                                if (_this._abortControllers[abortStoreName]) {\n                                                    _this._abortControllers[abortStoreName].abort(payload === null || payload === void 0 ? void 0 : payload.reason);\n                                                    delete _this._abortControllers[abortStoreName];\n                                                }\n                                            }\n                                            break;\n                                        case client_messages_1.ChattyClientMessages.Response:\n                                            {\n                                                var receiver = _this._receivers[evt.data.data.sequence];\n                                                if (receiver) {\n                                                    delete _this._receivers[evt.data.data.sequence];\n                                                    if (receiver.timeoutId) {\n                                                        clearTimeout(receiver.timeoutId);\n                                                    }\n                                                    receiver.resolve(evt.data.data.payload);\n                                                }\n                                            }\n                                            break;\n                                        case client_messages_1.ChattyClientMessages.ResponseError:\n                                            {\n                                                var receiver = _this._receivers[evt.data.data.sequence];\n                                                if (receiver) {\n                                                    delete _this._receivers[evt.data.data.sequence];\n                                                    if (receiver.timeoutId) {\n                                                        clearTimeout(receiver.timeoutId);\n                                                    }\n                                                    receiver.reject(typeof evt.data.data.payload === 'string'\n                                                        ? new Error(evt.data.data.payload)\n                                                        : evt.data.data.payload);\n                                                }\n                                            }\n                                            break;\n                                    }\n                                };\n                                var windowListener = function (evt) {\n                                    if (!_this.isValidMsg(evt)) {\n                                        // don't reject here, since that breaks the promise resolution chain\n                                        ChattyHost._debug('window received invalid', evt);\n                                        return;\n                                    }\n                                    ChattyHost._debug('window received', evt.data.action, evt.data.data);\n                                    switch (evt.data.action) {\n                                        case client_messages_1.ChattyClientMessages.Syn:\n                                            if (_this._port) {\n                                                // If targetOrigin is set and we receive another Syn, the frame has potentially\n                                                // navigated to another valid webpage and we should re-connect\n                                                if ((_this._targetOrigin && _this._targetOrigin === '*') ||\n                                                    _this._targetOrigin === evt.origin) {\n                                                    ChattyHost._debug('reconnecting to', evt.origin);\n                                                    _this._port.close();\n                                                }\n                                                else {\n                                                    ChattyHost._debug('rejected new connection from', evt.origin);\n                                                    return;\n                                                }\n                                            }\n                                            _this._port = evt.ports[0];\n                                            _this._port.onmessage = eventListener;\n                                            _this.sendMsg(host_messages_1.ChattyHostMessages.SynAck);\n                                            _this._state = ChattyHostStates.SynAck;\n                                            break;\n                                    }\n                                };\n                                _this._hostWindow.addEventListener('message', windowListener);\n                            })];\n                    });\n                }); };\n                this._appendTo.appendChild(this.iframe);\n                return [2 /*return*/, (this._connection = createConnection())];\n            });\n        });\n    };\n    ChattyHost.prototype.sendMsg = function (action, data, sequence, propagateSignal) {\n        if (data === void 0) { data = {}; }\n        var sequenceData = sequence ? { sequence: sequence } : {};\n        var signalData = propagateSignal === true ? { signal: propagateSignal } : {};\n        var dataWithSequence = __assign(__assign(__assign({}, data), sequenceData), signalData);\n        ChattyHost._debug('sending', action, dataWithSequence);\n        this._port.postMessage({ action: action, data: dataWithSequence });\n    };\n    // TODO: natenate\n    // Frustratingly, enabling `allow-scripts` on a sandboxed iframe sets its origin to `'null'`\n    // (that is, a string literal with a value of null). This means that in order to `postMessage`\n    // to the client we must use `'*'` as the origin parameter.  To ensure messages received from\n    // the client are who they claim to be, we check the origin is `'null'` and the contentWindow\n    // is the one we have access to from the parent frame.  This method is described here:\n    // https://www.html5rocks.com/en/tutorials/security/sandboxed-iframes/#safely-sandboxing-eval\n    // If sandboxing is not enabled targetOrigin can be set and validated\n    ChattyHost.prototype.isValidMsg = function (evt) {\n        if (evt.source !== this.iframe.contentWindow)\n            return false;\n        if (this._targetOrigin &&\n            !(this._targetOrigin === '*' || this._targetOrigin === evt.origin))\n            return false;\n        return true;\n    };\n    ChattyHost._debug = debugLib('looker:chatty:host');\n    return ChattyHost;\n}());\nexports.ChattyHost = ChattyHost;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}